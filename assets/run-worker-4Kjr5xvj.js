const s=new TextEncoder,p=new TextDecoder;let e=null,a=null;async function P(){if(e)return;const r=await(await fetch(new URL("/wren-lsp/assets/wren-runner-CkzKrIxT.wasm",import.meta.url))).arrayBuffer(),n=(await import("./index-DLpwg0kr.js")).WASI,o=[{fd_write:()=>{throw new Error("stdio write is not supported")},fd_read:()=>{throw new Error("stdio read is not supported")}},{fd_write:()=>{throw new Error("stdio write is not supported")},fd_read:()=>{throw new Error("stdio read is not supported")}},{fd_write:()=>{throw new Error("stdio write is not supported")},fd_read:()=>{throw new Error("stdio read is not supported")}}];a=new n(["wren-runner.wasm"],[],o,{debug:!1});const{instance:t}=await WebAssembly.instantiate(r,{wasi_snapshot_preview1:a.wasiImport,env:{memory:new WebAssembly.Memory({initial:256,maximum:512})}});a.inst=t,e=t.exports}self.addEventListener("message",async i=>{const{token:r,source:n,virtualFiles:o}=i.data;try{if(await P(),o)for(const[E,b]of Object.entries(o)){const u=s.encode(E),w=s.encode(b),A=e.allocVirtualFilePath(u.length),_=e.allocVirtualFileContent(w.length);new Uint8Array(e.memory.buffer).set(u,A),new Uint8Array(e.memory.buffer).set(w,_),e.setVirtualFile()}const t=s.encode(n),l=e.allocSource(t.length);new Uint8Array(e.memory.buffer).set(t,l);const m=e.runCode(),f=e.getOutputPtr(),c=e.getOutputLen(),y=c>0?p.decode(new Uint8Array(e.memory.buffer,f,c)):"",h=e.getErrorPtr(),d=e.getErrorLen(),g=d>0?p.decode(new Uint8Array(e.memory.buffer,h,d)):"";postMessage({token:r,output:y,errors:g,result:m})}catch(t){postMessage({token:r,output:"",errors:t instanceof Error?t.message:String(t),result:2})}});
